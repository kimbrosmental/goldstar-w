<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>Admin</title><link rel="stylesheet" href="style.css"/>
<style>
	body{padding-top:100px;}
	.admin-wrap{max-width:none;width:100%;margin:0 auto;color:#fff;padding:20px 30px 80px;}
	h1{font-size:34px;margin-bottom:24px;color:#FFD700;}
	.btn{background:#00695C;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:14px;cursor:pointer;}
	.btn:hover{background:#00897B;}
	.btn.active{background:#00897B;box-shadow:0 0 0 2px rgba(255,215,0,.3) inset;}
	.tabs{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 12px;}
	.right-tools{display:flex;gap:8px;align-items:center;margin-left:auto;}
	.headbar{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin:6px 0 14px;}
	#adminContent{border:1px solid #1e4d47;border-radius:12px;overflow:auto;background:#0c1a18;max-height:75vh;padding:16px;}
	.hint{color:#9ec9c3;font-size:12px;margin:8px 0 0;}
	.pill{display:inline-block;padding:2px 6px;border-radius:12px;background:#1e4d47;font-size:11px;margin-left:4px;}
	/* Inline panel shared styles (from subpages) */
	.btn{background:#00695C;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:13px;cursor:pointer;}
	.btn:hover{background:#00897B;}
	.btn.small{font-size:12px;padding:6px 10px;}
	.btn.danger{background:#b71c1c;}
	.btn.danger:hover{background:#d32f2f;}
	.detail-box{background:#0c1a18;border:1px solid #1e4d47;border-radius:10px;padding:14px;}
	.detail-grid{display:grid;grid-template-columns:120px 1fr;gap:8px;}
	.detail-grid input, .detail-grid textarea{background:#0b1917;color:#fff;border:1px solid #1e4d47;border-radius:6px;padding:8px 10px;font-size:13px;}
	table{width:100%;border-collapse:collapse;}
	th,td{border:1px solid #1e4d47;padding:10px 12px;font-size:13px;}
	th{background:#004d40;color:#FFD700;}
	/* ì„ íƒëœ í–‰ ê°•ì¡° (ë¹¨ê°„ ê¸€ì”¨) */
	tr.selected td, .row-user.selected td{color:#ff5252;}
	/* ê¸´ í…Œì´ë¸” ê°€ë¡œ ìŠ¤í¬ë¡¤ */
	.hscroll{overflow-x:auto;}
	#usersTable table{min-width:1400px;}
	.muted{color:#aaa;}
	.scroll{max-height:60vh;overflow:auto;padding-right:4px;}
	.list-card{background:#0c1a18;border:1px solid #1e4d47;border-radius:10px;padding:10px;margin-bottom:10px;}
	.nowrap{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
	.user-chip{display:inline-flex;align-items:center;gap:6px;background:#0b1917;border:1px solid #1e4d47;padding:6px 10px;border-radius:999px;}
	.user-chip small{color:#9ec9c3;}
	.grid2{display:grid;grid-template-columns:90px 1fr 90px 1fr;gap:8px;}
	@media (max-width:700px){ .grid2{grid-template-columns:1fr 1fr;} }
	/* Inquiries */
	.inq-row{display:grid;grid-template-columns:320px 1fr;gap:16px;}
	.panel{background:#0c1a18;border:1px solid #1e4d47;border-radius:12px;padding:12px;}
	.list{max-height:560px;overflow:auto;}
	.item{border:1px solid #1e4d47;padding:8px;border-radius:8px;margin-bottom:8px;cursor:pointer;}
	.item.unread{border-color:#b71c1c;background:rgba(183,28,28,.15);}
	.thread .bubble{border:1px solid #1e4d47;padding:10px;border-radius:10px;margin:6px 0;}
	.thread .from-admin{background:#12372f;}
</style></head><body>
<nav id="navbar"><div class="container"><div class="logo"><img src="img/logo.png" data-i18n-alt="alt_logo" alt="logo"/></div><div class="nav-center"><ul class="nav-links"><li><a href="index.html#section1" data-i18n="nav_intro">ì†Œê°œ</a></li><li><a href="index.html#section2" data-i18n="nav_progress">ì§„í–‰</a></li><li><a href="index.html#section3" data-i18n="nav_video">ì˜ìƒ</a></li><li><a href="index.html#section4" data-i18n="nav_history">ì´ë ¥</a></li><li><a href="index.html#section5" data-i18n="nav_contact">ë¬¸ì˜</a></li></ul></div><div class="nav-right"><select id="langSelect" class="lang-select" data-i18n-aria="aria_lang_select" aria-label="ì–¸ì–´ ì„ íƒ"><option value="ko">í•œêµ­ì–´</option><option value="zh">ä¸­æ–‡</option><option value="en">English</option></select><div id="userArea" class="user-area"></div><a href="index.html" class="home-icon" data-i18n-aria="nav_home" aria-label="í™ˆ" style="display:flex;align-items:center;justify-content:center;width:56px;height:56px;background:#004d40;border-radius:16px;border:2px solid #00695C;transition:.3s;text-decoration:none;"><span style="font-size:30px;color:#FFD700;">ğŸ </span></a><div class="menu-btn" data-i18n-aria="aria_menu_open" aria-label="ë©”ë‰´" role="button" tabindex="0"><span></span><span></span><span></span></div></div></div></nav>

<main>
	<div class="admin-wrap">
		<h1 data-i18n="page_admin_title">ê´€ë¦¬ì í˜ì´ì§€</h1>
		<div class="headbar">
			<div class="tabs" role="tablist" aria-label="Admin Tabs">
				<button class="btn" id="tabUsers" type="button" role="tab" aria-controls="panelUsers" aria-selected="false" style="min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:8px;">
					<span>ğŸ‘¤</span><span data-i18n="tab_users_admin">íšŒì› ê´€ë¦¬</span>
				</button>
				<button class="btn" id="tabOrders" type="button" role="tab" aria-controls="panelOrders" aria-selected="false" style="min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:8px;">
					<span>ğŸ§¾</span><span data-i18n="section_orders_admin">ì£¼ë¬¸ ê´€ë¦¬</span>
				</button>
				<button class="btn" id="tabInquiries" type="button" role="tab" aria-controls="panelInquiries" aria-selected="false" style="min-width:160px;display:inline-flex;align-items:center;justify-content:center;gap:8px;position:relative;">
					<span>ğŸ’¬</span><span data-i18n="section_messages_admin">1:1 ë¬¸ì˜</span>
					<span id="newBadge" class="pill" style="display:none;position:absolute;top:-8px;right:-8px;background:#b71c1c;color:#fff;">NEW</span>
				</button>
			</div>
			<div class="right-tools">
				<button class="btn" id="btnChangePw" data-i18n="btn_change_admin_password">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
				<button class="btn danger" id="btnLogout" type="button">ë¡œê·¸ì•„ì›ƒ</button>
				<span id="pwChangeMsg" class="hint"></span>
			</div>
		</div>
				<div id="adminContent">
					<!-- Users Panel -->
					<section id="panelUsers" role="tabpanel" aria-labelledby="tabUsers">
						<div id="adminInfoUsers" class="detail-box" style="margin-bottom:14px;"></div>
						<!-- ìƒë‹¨: ìƒì„¸/ê´€ë¦¬ ì˜ì—­ -->
						<div>
							<h2>ìƒì„¸/ê´€ë¦¬</h2>
							<div id="userDetail" class="detail-box" style="min-height:280px;">
								<div class="muted" style="font-size:13px;">ì™¼ìª½ ëª©ë¡ì—ì„œ íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”.</div>
							</div>
							<div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
								<button class="btn" id="btnUserAdd" data-i18n="btn_add_user">ì¶”ê°€</button>
								<button class="btn" id="btnUserEdit" data-i18n="btn_edit">ìˆ˜ì •</button>
								<button class="btn" id="btnUserSave" style="display:none;" data-i18n="btn_save">ì €ì¥</button>
								<button class="btn danger" id="btnUserDelete" data-i18n="btn_delete">ì‚­ì œ</button>
							</div>
							<div class="muted" id="userMsg" style="font-size:12px;margin-top:6px;"></div>
						</div>

						<!-- í•˜ë‹¨: íšŒì› ëª©ë¡ ì˜ì—­ (ê°€ë¡œë¡œ ê¸¸ê²Œ í‘œì‹œ) -->
						<div style="margin-top:18px;">
							<div style="display:flex;align-items:center;gap:8px;justify-content:space-between;">
								<h2 data-i18n="section_users" style="margin:0;">íšŒì› ëª©ë¡</h2>
								<div style="display:flex;gap:8px;align-items:center;">
									<button id="btnUsersExport" class="btn small">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
									<button id="btnUsersRefresh" class="btn small" data-i18n="btn_refresh">ìƒˆë¡œê³ ì¹¨</button>
								</div>
							</div>
							<div id="usersTable" class="hscroll"></div>
						</div>
					</section>
					<!-- Orders Panel -->
					<section id="panelOrders" role="tabpanel" aria-labelledby="tabOrders" hidden>
						<div id="adminInfoOrders" class="detail-box" style="margin-bottom:14px;"></div>
						<div style="display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start;">
							<div style="flex:1;min-width:420px;">
								<div style="display:flex;align-items:center;gap:8px;justify-content:space-between;">
									<h2 data-i18n="section_orders_admin" style="margin:0;">ì£¼ë¬¸ ê´€ë¦¬</h2>
									<button id="btnOrdersRefresh" class="btn small" data-i18n="btn_refresh">ìƒˆë¡œê³ ì¹¨</button>
								</div>
								<div id="ordersList" class="scroll"></div>
							</div>
							<div style="flex:1;min-width:420px;">
								<h2>ìƒì„¸/ê´€ë¦¬</h2>
								<div id="orderDetail" class="detail-box" style="min-height:280px;">
									<div class="muted" style="font-size:13px;">ì™¼ìª½ì—ì„œ ì£¼ë¬¸ì„ ì„ íƒí•˜ê±°ë‚˜, íšŒì›ë³„ ì¶”ê°€ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
								</div>
								<div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
									<button class="btn" id="btnOrderCreate" data-i18n="btn_add_order_admin">ì£¼ë¬¸ ì¶”ê°€</button>
									<button class="btn" id="btnOrderEdit" data-i18n="btn_edit">ìˆ˜ì •</button>
									<button class="btn" id="btnOrderSave" style="display:none;" data-i18n="btn_save">ì €ì¥</button>
									<button class="btn danger" id="btnOrderDelete" data-i18n="btn_delete">ì‚­ì œ</button>
								</div>
								<div class="muted" id="orderMsg" style="font-size:12px;margin-top:6px;"></div>
							</div>
						</div>
					</section>
					<!-- Inquiries Panel -->
					<section id="panelInquiries" role="tabpanel" aria-labelledby="tabInquiries" hidden>
						<div id="adminInfoInq" class="detail-box" style="margin-bottom:14px;"></div>
						<div class="panel" style="margin-bottom:10px;display:flex;gap:8px;align-items:center;">
							<label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="onlyUnread"> ìƒˆ ë¬¸ì˜ë§Œ</label>
							<button id="btnInqRefresh" class="btn small" data-i18n="btn_refresh">ìƒˆë¡œê³ ì¹¨</button>
							<span id="newCount" class="pill" style="display:none;background:#b71c1c;color:#fff;">0</span>
						</div>
						<div class="inq-row">
							<div class="panel list" id="userList"></div>
							<div class="panel detail">
								<div id="thread" class="thread"></div>
								<div style="margin-top:10px;display:flex;gap:8px;align-items:flex-start;">
									<input id="replyEmail" type="hidden" />
									<textarea id="replyContent" placeholder="ë‹µë³€ ë‚´ìš©" style="flex:1;min-height:72px;"></textarea>
									<button id="markReadBtn" class="btn" style="min-width:120px;">ì½ìŒìœ¼ë¡œ í‘œì‹œ</button>
									<button id="sendReplyBtn" class="btn" data-i18n="btn_send_reply">ë‹µë³€</button>
								</div>
							</div>
						</div>
					</section>
				</div>
		<p class="hint">ì›í•˜ëŠ” ê´€ë¦¬ ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”.</p>
	</div>
	</main>
	<script src="app.js"></script>
	<script>
		function forceNavigateIfHidden(tabId){
			const map={tabUsers:'users',tabOrders:'orders',tabInquiries:'inquiries'};
			const panelId = tabId==='tabUsers'?'panelUsers':tabId==='tabOrders'?'panelOrders':'panelInquiries';
			setTimeout(()=>{
				const panel=document.getElementById(panelId);
				if(!panel || panel.hidden===true){
					try{
						location.href = 'admin.html?page='+(map[tabId]||'users');
					}catch(_){ /* no-op */ }
				}
			}, 120);
		}
		const menuBtn=document.querySelector('.menu-btn');
		menuBtn?.addEventListener('click',()=>{menuBtn.classList.toggle('active');document.querySelector('.nav-links')?.classList.toggle('active');});

		function requireAdmin(){const u=GSApp.currentUser();if(!u||u.role!=="admin"){alert('ê´€ë¦¬ì ê¶Œí•œ í•„ìš”');location.href='login.html';return false;}return true;}

		function updateNewBadge(){
			const db=GSApp.getDB(); let unread=0;
			Object.values(db.users).forEach(u=>{ (u.messages||[]).forEach(m=>{ if(!m.fromAdmin && !m.read) unread++; }); });
			const b=document.getElementById('newBadge');
			if(b){ b.style.display = unread>0 ? 'inline-block' : 'none'; b.textContent = unread>0? ('NEW '+unread):''; }
		}

		document.getElementById('btnChangePw').addEventListener('click',async()=>{
			if(!requireAdmin())return; const newPw=prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥'); if(!newPw) return;
			const admin=GSApp.currentUser();
			try{ await GSApp.changePassword(admin.email,newPw); pwChangeMsg.style.color='#4fc3f7'; pwChangeMsg.textContent=GSApp.t('pw_change_success'); }
			catch(e){ pwChangeMsg.style.color='#ff5252'; pwChangeMsg.textContent=GSApp.t('pw_change_fail'); }
		});

		document.getElementById('btnLogout').addEventListener('click',(e)=>{ e.preventDefault(); GSApp.logout(); location.href='index.html'; });

		async function activate(tabId){
				// visual active + aria selected
				document.querySelectorAll('.tabs .btn').forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
				const b=document.getElementById(tabId); if(b){ b.classList.add('active'); b.setAttribute('aria-selected','true'); }
			document.getElementById('panelUsers').hidden = tabId!=='tabUsers';
			document.getElementById('panelOrders').hidden = tabId!=='tabOrders';
			document.getElementById('panelInquiries').hidden = tabId!=='tabInquiries';
			// íƒ­ ì „í™˜ ì‹œ ê° íŒ¨ë„ ì¦‰ì‹œ ê°±ì‹ 
			try{
				await GSApp.loadDB();
				if(tabId==='tabUsers'){
					renderAdminInfoUsers(); renderUsers(); renderUserDetail();
				}else if(tabId==='tabOrders'){
					if(typeof renderOrdersAll==='function') renderOrdersAll(); else { renderAdminInfoOrders(); renderOrdersList(); renderOrderDetail(); }
				}else if(tabId==='tabInquiries'){
					if(typeof renderInquiriesAll==='function') renderInquiriesAll(); else { renderAdminInfoInq(); renderInqList(); }
					updateNewBadge();
				}
				// URL ë™ê¸°í™” (ë”¥ë§í¬ ë° ìƒˆë¡œê³ ì¹¨ì‹œ ìœ ì§€)
				const page = tabId==='tabUsers' ? 'users' : tabId==='tabOrders' ? 'orders' : 'inquiries';
				const url = new URL(location.href);
				url.searchParams.set('page', page);
				history.replaceState(null, '', url.toString());
					// íƒ­ í™œì„±í™” ì¦‰ì‹œ, í•´ë‹¹ íŒ¨ë„ì˜ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­ê³¼ ë™ì¼í•œ íš¨ê³¼ ì‹¤í–‰
					const refreshMap = { tabUsers:'btnUsersRefresh', tabOrders:'btnOrdersRefresh', tabInquiries:'btnInqRefresh' };
					const refreshBtnId = refreshMap[tabId];
					if(refreshBtnId){ const rb = document.getElementById(refreshBtnId); if(rb && typeof rb.click==='function'){ try{ rb.click(); }catch(_){} } }
			}catch(_){/* no-op */}
		}
		function initTabs(){
			const params=new URLSearchParams(location.search); const which=params.get('page')||'users';
			const tabId = 'tab'+which.charAt(0).toUpperCase()+which.slice(1);
			activate(tabId);
			const contentEl = document.getElementById('adminContent');
			document.getElementById('tabUsers').addEventListener('click',(e)=>{ e.preventDefault(); activate('tabUsers').then(()=>{ try{ contentEl?.scrollIntoView({behavior:'smooth',block:'start'});}catch(_){}; forceNavigateIfHidden('tabUsers'); }); });
			document.getElementById('tabOrders').addEventListener('click',(e)=>{ e.preventDefault(); activate('tabOrders').then(()=>{ try{ contentEl?.scrollIntoView({behavior:'smooth',block:'start'});}catch(_){}; forceNavigateIfHidden('tabOrders'); }); });
			document.getElementById('tabInquiries').addEventListener('click',(e)=>{ e.preventDefault(); activate('tabInquiries').then(()=>{ try{ contentEl?.scrollIntoView({behavior:'smooth',block:'start'});}catch(_){}; forceNavigateIfHidden('tabInquiries'); }); });
			// Fallback: parent-level delegation
			const tabsWrap = document.querySelector('.tabs');
			if(tabsWrap){
				tabsWrap.addEventListener('click', (e)=>{
					const btn = e.target.closest('button.btn');
					if(!btn) return;
					e.preventDefault();
					const id = btn.id;
					if(id==='tabUsers') activate('tabUsers').then(()=>forceNavigateIfHidden('tabUsers'));
					else if(id==='tabOrders') activate('tabOrders').then(()=>forceNavigateIfHidden('tabOrders'));
					else if(id==='tabInquiries') activate('tabInquiries').then(()=>forceNavigateIfHidden('tabInquiries'));
				});
			}
		}

		document.addEventListener('DOMContentLoaded',async()=>{ if(window.GSApp){ GSApp.applyLang(); GSApp.buildUserNav(); if(requireAdmin()){ await GSApp.loadDB(); updateNewBadge(); initTabs(); initUsers(); initOrders(); initInquiries(); } } });

		// ===== Users Inline Logic =====
		let userSelectedEmail=null; let userEditMode=false; let userCreateMode=false;
		function renderAdminInfoUsers(){ const box=document.getElementById('adminInfoUsers'); const a=GSApp.currentUser(); if(!a){ box.innerHTML=''; return;} const online=a.lastSeenAt&&(Date.now()-a.lastSeenAt<5*60*1000); box.innerHTML=`<h3 style='margin:0 0 8px;' data-i18n='section_admin_info'>ê´€ë¦¬ì ì •ë³´</h3><div class='detail-grid'><div>ì•„ì´ë””</div><div>${a.username||''}</div><div>ì´ë©”ì¼</div><div>${a.email}</div><div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class="pill" style="background:#2e7d32;color:#fff;">ì˜¨ë¼ì¸</span>':'<span class="pill">ì˜¤í”„ë¼ì¸</span>'}</div><div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${a.lastLoginAt? new Date(a.lastLoginAt).toLocaleString('ko-KR'):'-'}</div><div>ìµœê·¼ í™œë™</div><div>${a.lastSeenAt? new Date(a.lastSeenAt).toLocaleString('ko-KR'):'-'}</div><div>ì ‘ì† IP</div><div>${a.lastLoginIP||'-'}</div><div>ë¸Œë¼ìš°ì €</div><div class='nowrap'>${a.lastLoginUA||'-'}</div></div>`; }
		function renderUsers(){
			const db=GSApp.getDB();
			const now = Date.now();
			const rows=Object.values(db.users).map(u=>{
				const online = u.lastSeenAt && (now - u.lastSeenAt < 5*60*1000);
				return `<tr class='row-user ${userSelectedEmail===u.email?'selected':''}' data-email='${u.email}'>
					<td>${u.username||''}</td>
					<td>${u.email}${u.role==='admin'?'<span class=\"pill\">admin</span>':''}</td>
					<td>${u.name||''}</td>
					<td>${u.phone||''}</td>
					<td>${u.birth||''}</td>
					<td>${u.bank||''}</td>
					<td>${u.account||''}</td>
					<td>${u.role||''}</td>
					<td>${online? '<span class=\"pill\" style=\"background:#2e7d32;color:#fff;\">ì˜¨ë¼ì¸</span>' : '<span class=\"pill\">ì˜¤í”„ë¼ì¸</span>'}</td>
					<td>${u.lastSeenAt? new Date(u.lastSeenAt).toLocaleString('ko-KR'):''}</td>
					<td>${u.lastLoginAt? new Date(u.lastLoginAt).toLocaleString('ko-KR'):''}</td>
					<td>${u.lastLoginIP||''}</td>
					<td>${(u.orders||[]).length}</td>
					<td>${u.created? new Date(u.created).toLocaleString('ko-KR'):''}</td>
				</tr>`;
			}).join('');
			document.getElementById('usersTable').innerHTML=
				`<table><thead><tr>
					<th>ì•„ì´ë””</th><th>ì´ë©”ì¼</th><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ìƒë…„ì›”ì¼</th><th>ì€í–‰</th><th>ê³„ì¢Œ</th><th>ê¶Œí•œ</th><th>ì ‘ì†ì¤‘</th><th>ìµœê·¼í™œë™</th><th>ë§ˆì§€ë§‰ì ‘ì†</th><th>ì ‘ì†IP</th><th>ì£¼ë¬¸ìˆ˜</th><th>ê°€ì…ì¼</th>
				</tr></thead><tbody>${rows}</tbody></table>`;
			document.querySelectorAll('.row-user').forEach(tr=>tr.addEventListener('click',()=>{ userSelectedEmail=tr.dataset.email; userCreateMode=false; userEditMode=false; renderUserDetail(); renderUsers(); }));
			if(window.GSApp) GSApp.applyLang();
		}
		function renderUserDetail(){
			const box=document.getElementById('userDetail');
			if(userCreateMode){
				box.innerHTML=`<h3 style='margin:0 0 10px;'>ì‹ ê·œ íšŒì› ì¶”ê°€</h3><div class='detail-grid'><label>ì•„ì´ë””</label><input id='f_username' placeholder='ì•„ì´ë””'/><label>ì´ë¦„</label><input id='f_name' placeholder='ì´ë¦„'/><label>ì´ë©”ì¼</label><input id='f_email' placeholder='ì´ë©”ì¼'/><label>ì—°ë½ì²˜</label><input id='f_phone' placeholder='ì—°ë½ì²˜'/><label>ìƒë…„ì›”ì¼</label><input id='f_birth' type='date'/><label>ì€í–‰</label><input id='f_bank' placeholder='ì€í–‰'/><label>ê³„ì¢Œ</label><input id='f_account' placeholder='ê³„ì¢Œë²ˆí˜¸'/><label>ë¹„ë°€ë²ˆí˜¸</label><input id='f_password' type='password' placeholder='ë¹„ë°€ë²ˆí˜¸'/></div>`;
				document.getElementById('btnUserSave').style.display='inline-block';
				return;
			}
			if(!userSelectedEmail){
				box.innerHTML='<div class="muted" style="font-size:13px;">ì™¼ìª½ ëª©ë¡ì—ì„œ íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”.</div>';
				document.getElementById('btnUserSave').style.display='none';
				return;
			}
			const u=GSApp.getDB().users[userSelectedEmail];
			if(!u){ box.innerHTML='<div>íšŒì› ì—†ìŒ</div>'; document.getElementById('btnUserSave').style.display='none'; return; }
			const online = u.lastSeenAt && (Date.now()-u.lastSeenAt < 5*60*1000);
			// ì–´ë“œë¯¼ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€
			document.getElementById('btnUserDelete').style.display = (u.role==='admin') ? 'none' : 'inline-block';
			if(userEditMode){
				box.innerHTML = `<h3 style='margin:0 0 10px;'>íšŒì› ìˆ˜ì •</h3><div class='detail-grid'><label>ì•„ì´ë””</label><input id='f_username' value='${u.username||''}' disabled/><label>ì´ë¦„</label><input id='f_name' value='${u.name||''}'/><label>ì´ë©”ì¼</label><input id='f_email' value='${u.email}' disabled/><label>ì—°ë½ì²˜</label><input id='f_phone' value='${u.phone||''}'/><label>ìƒë…„ì›”ì¼</label><input id='f_birth' type='date' value='${u.birth||''}'/><label>ì€í–‰</label><input id='f_bank' value='${u.bank||''}'/><label>ê³„ì¢Œ</label><input id='f_account' value='${u.account||''}'/><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label><input id='f_newpw' type='password' placeholder='ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥'/></div>`;
				document.getElementById('btnUserSave').style.display='inline-block';
			} else {
				box.innerHTML = `<div class='detail-grid'><div>ì•„ì´ë””</div><div>${u.username||''}</div><div>ì´ë¦„</div><div>${u.name||''}</div><div>ì´ë©”ì¼</div><div>${u.email}</div><div>ì—°ë½ì²˜</div><div>${u.phone||''}</div><div>ìƒë…„ì›”ì¼</div><div>${u.birth||''}</div><div>ì€í–‰</div><div>${u.bank||''}</div><div>ê³„ì¢Œ</div><div>${u.account||''}</div><div>ê°€ì…ì¼</div><div>${u.created? new Date(u.created).toLocaleString('ko-KR'):''}</div><div>ê¶Œí•œ</div><div>${u.role}</div><div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class=\"pill\" style=\"background:#2e7d32;color:#fff;\">ì˜¨ë¼ì¸</span>':'<span class=\"pill\">ì˜¤í”„ë¼ì¸</span>'}</div><div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${u.lastLoginAt? new Date(u.lastLoginAt).toLocaleString('ko-KR'):'-'}</div><div>ìµœê·¼ í™œë™</div><div>${u.lastSeenAt? new Date(u.lastSeenAt).toLocaleString('ko-KR'):'-'}</div><div>ì ‘ì† IP</div><div>${u.lastLoginIP||'-'}</div><div>ë¸Œë¼ìš°ì €</div><div class='nowrap'>${u.lastLoginUA||'-'}</div></div>`;
				document.getElementById('btnUserSave').style.display='none';
			}
		}
		async function usersAdd(){
			const username=prompt('ì•„ì´ë””');
			const name=prompt('ì´ë¦„');
			const email=(prompt('ì´ë©”ì¼')||'').toLowerCase();
			const phone=prompt('ì—°ë½ì²˜')||'';
			const birth=prompt('ìƒë…„ì›”ì¼(YYYY-MM-DD)')||'';
			const bank=prompt('ì€í–‰')||'';
			const account=prompt('ê³„ì¢Œ')||'';
			const password=prompt('ë¹„ë°€ë²ˆí˜¸')||'temp1234';
			const msgEl = document.getElementById('userMsg');
			if(!username||!name||!email){ msgEl.textContent='í•„ìˆ˜ í•­ëª©'; return; }
			try{
				await GSApp.signupUser({username,name,birth,phone,email,bank,account,password});
				msgEl.style.color='#4fc3f7';
				msgEl.textContent='ì¶”ê°€ ì™„ë£Œ';
				await GSApp.loadDB();
				renderUsers();
				renderUserDetail();
			}catch(e){
				msgEl.style.color='#ff5252';
				msgEl.textContent=e.message||'ì˜¤ë¥˜';
			}
		}
		document.getElementById('btnUserAdd').addEventListener('click',()=>{ userCreateMode=true; userEditMode=false; userSelectedEmail=null; renderUserDetail(); });
		document.getElementById('btnUserEdit').addEventListener('click',()=>{ if(!userSelectedEmail) return; userCreateMode=false; userEditMode=true; renderUserDetail(); });
		document.getElementById('btnUserSave').addEventListener('click', async ()=>{
			const msgEl = document.getElementById('userMsg');
			if(userCreateMode){
				if(!confirm('ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
				const username=f_username.value.trim();
				const name=f_name.value.trim();
				const email=f_email.value.trim().toLowerCase();
				const phone=f_phone.value.trim();
				const birth=f_birth.value;
				const bank=f_bank.value.trim();
				const account=f_account.value.trim();
				const password=f_password.value||'temp1234';
				if(!username||!name||!email||!phone||!birth){ msgEl.textContent='í•„ìˆ˜ í•­ëª©'; return; }
				try{
					await GSApp.signupUser({username,name,birth,phone,email,bank,account,password});
					msgEl.style.color='#4fc3f7';
					msgEl.textContent='ì¶”ê°€ ì™„ë£Œ';
					userCreateMode=false;
					userSelectedEmail=email;
					await GSApp.loadDB();
					renderUsers();
					renderUserDetail();
				}catch(e){
					msgEl.style.color='#ff5252';
					msgEl.textContent=e.message||'ì˜¤ë¥˜';
				}
			} else if(userEditMode){
				if(!confirm('ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
				const name=f_name.value.trim();
				const phone=f_phone.value.trim();
				const birth=f_birth.value;
				const bank=f_bank.value.trim();
				const account=f_account.value.trim();
				const newPw=(document.getElementById('f_newpw')?.value||'').trim();
				try{
					await GSApp.updateUser(userSelectedEmail,{name,phone,bank,account,birth});
					if(newPw){ await GSApp.changePassword(userSelectedEmail,newPw); }
					msgEl.style.color='#4fc3f7';
					msgEl.textContent=GSApp.t('msg_update_success');
					userEditMode=false;
					await GSApp.loadDB();
					renderUsers();
					renderUserDetail();
				}catch(e){
					msgEl.style.color='#ff5252';
					msgEl.textContent=GSApp.t('msg_update_fail');
				}
			}
		});
		document.getElementById('btnUserDelete').addEventListener('click',async()=>{
			if(!userSelectedEmail) return;
			const u=GSApp.getDB().users[userSelectedEmail];
			if(u && u.role==='admin'){ alert('ê´€ë¦¬ì ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
			if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const db=GSApp.getDB();
			delete db.users[userSelectedEmail]; await GSApp.saveDB(); userSelectedEmail=null; userCreateMode=false; userEditMode=false; await GSApp.loadDB(); renderUsers(); renderUserDetail();
		});
		document.getElementById('btnUsersRefresh').addEventListener('click', async ()=>{ await GSApp.loadDB(); renderAdminInfoUsers(); renderUsers(); renderUserDetail(); });
		document.getElementById('btnUsersExport').addEventListener('click',()=>{
			const db=GSApp.getDB();
			const rows = Object.values(db.users).map(u=>({
				ì•„ì´ë””: u.username||'',
				ì´ë¦„: u.name||'',
				ì´ë©”ì¼: u.email||'',
				ì—°ë½ì²˜: u.phone||'',
				ìƒë…„ì›”ì¼: u.birth||'',
				ì€í–‰: u.bank||'',
				ê³„ì¢Œ: u.account||'',
				ê¶Œí•œ: u.role||'',
				ê°€ì…ì¼: u.created||''
			}));
			const header = Object.keys(rows[0]||{ì•„ì´ë””:'',ì´ë¦„:'',ì´ë©”ì¼:'',ì—°ë½ì²˜:'',ìƒë…„ì›”ì¼:'',ì€í–‰:'',ê³„ì¢Œ:'',ê¶Œí•œ:'',ê°€ì…ì¼:''});
			const csv = [header.join(','), ...rows.map(r=>header.map(k=>`"${String(r[k]??'').replace(/"/g,'""')}"`).join(','))].join('\r\n');
			const blob = new Blob(["\uFEFF"+csv],{type:'text/csv;charset=utf-8;'});
			const url=URL.createObjectURL(blob);
			const a=document.createElement('a'); a.href=url; a.download='íšŒì›ëª©ë¡.csv'; a.click();
			URL.revokeObjectURL(url);
		});
		function initUsers(){ renderAdminInfoUsers(); renderUsers(); renderUserDetail(); }

		// ===== Orders Inline Logic =====
		let orderSelected=null; // { email, id }
		let orderEdit=false; let orderCreate=false;
		function renderAdminInfoOrders(){ const box=document.getElementById('adminInfoOrders'); const a=GSApp.currentUser(); if(!a){ box.innerHTML=''; return;} const online=a.lastSeenAt&&(Date.now()-a.lastSeenAt<5*60*1000); box.innerHTML=`<h3 style='margin:0 0 8px;' data-i18n='section_admin_info'>ê´€ë¦¬ì ì •ë³´</h3><div class='detail-grid'><div>ì•„ì´ë””</div><div>${a.username||''}</div><div>ì´ë©”ì¼</div><div>${a.email}</div><div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class=\"pill\" style=\"background:#2e7d32;color:#fff;\">ì˜¨ë¼ì¸</span>':'<span class=\"pill\">ì˜¤í”„ë¼ì¸</span>'}</div><div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${a.lastLoginAt? new Date(a.lastLoginAt).toLocaleString('ko-KR'):'-'}</div><div>ìµœê·¼ í™œë™</div><div>${a.lastSeenAt? new Date(a.lastSeenAt).toLocaleString('ko-KR'):'-'}</div><div>ì ‘ì† IP</div><div>${a.lastLoginIP||'-'}</div><div>ë¸Œë¼ìš°ì €</div><div class='nowrap'>${a.lastLoginUA||'-'}</div></div>`; }
		function formatKR(n){ try{ return Number(n).toLocaleString('ko-KR'); }catch(_){ return String(n); } }
		function renderOrdersList(){ const db=GSApp.getDB(); let html=''; Object.values(db.users).forEach(u=>{ const head = `<div class=\"head\"><div class=\"user-chip\"><strong>${u.username||''}</strong><small>${u.email}</small></div><button class=\"btn small addForUser\" data-user=\"${u.email}\" data-username=\"${u.username||''}\">+ ì¶”ê°€</button></div>`; const rows = (u.orders||[]).map(o=>{ const sel = (orderSelected && orderSelected.email===u.email && orderSelected.id===o.id) ? ' selected' : ''; return `<div class=\"list-card row-order${sel}\" data-email=\"${u.email}\" data-id=\"${o.id}\"><div style=\"display:flex;justify-content:space-between;gap:8px;align-items:center;\"><div class=\"nowrap\"><strong>${o.item}</strong> <span class=\"pill\">${o.id}</span></div><div class=\"nowrap muted\">${new Date(o.ts).toLocaleString('ko-KR')}</div></div><div class=\"grid2\" style=\"margin-top:6px;\"><label>ìˆ˜ëŸ‰</label><div>${o.qty}</div><label>ê°€ê²©</label><div>${formatKR(o.price)}</div></div><div class=\"toolbar\" style=\"margin-top:8px;\"><button class=\"btn small editOrder\" data-email=\"${u.email}\" data-id=\"${o.id}\">ìˆ˜ì •</button><button class=\"btn small danger delOrder\" data-email=\"${u.email}\" data-id=\"${o.id}\">ì‚­ì œ</button></div></div>`; }).join(''); html += `<div class=\"user-block\">${head}${rows || '<div class=\"muted\" data-i18n=\"orders_empty_admin\">ì£¼ë¬¸ ì—†ìŒ</div>'}</div>`; }); const list=document.getElementById('ordersList'); list.innerHTML = html || '<div class="muted" data-i18n="orders_empty_admin">ì£¼ë¬¸ ì—†ìŒ</div>'; document.querySelectorAll('.row-order').forEach(el=>el.addEventListener('click',()=>{ orderSelected={email:el.dataset.email,id:el.dataset.id}; orderCreate=false; orderEdit=false; renderOrderDetail(); renderOrdersList(); })); document.querySelectorAll('.addForUser').forEach(btn=>btn.addEventListener('click',()=>{ orderSelected={email:btn.dataset.user,id:null}; orderCreate=true; orderEdit=false; renderOrderDetail(); })); document.querySelectorAll('.editOrder').forEach(btn=>btn.addEventListener('click',()=>{ orderSelected={email:btn.dataset.email,id:btn.dataset.id}; orderCreate=false; orderEdit=true; renderOrderDetail(); renderOrdersList(); })); document.querySelectorAll('.delOrder').forEach(btn=>btn.addEventListener('click',async()=>{ const email=btn.dataset.email; const id=btn.dataset.id; if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const db=GSApp.getDB(); const u=db.users[email]; u.orders=(u.orders||[]).filter(o=>o.id!==id); await GSApp.saveDB(); if(orderSelected && orderSelected.email===email && orderSelected.id===id){ orderSelected=null; } await GSApp.loadDB(); renderOrdersAll(); })); if(window.GSApp) GSApp.applyLang(); }
		function renderOrderDetail(){ const box=document.getElementById('orderDetail'); const db=GSApp.getDB(); if(orderCreate){ box.innerHTML = `<h3 style='margin:0 0 10px;'>ì£¼ë¬¸ ì¶”ê°€</h3><div class='detail-grid'><div>íšŒì›</div><div>${orderSelected? (db.users[orderSelected.email]?.email||'') : ''}</div><label>ìƒí’ˆ</label><input id='f_item' placeholder='ìƒí’ˆëª…'/><label>ìˆ˜ëŸ‰(g)</label><input id='f_qty' type='number' step='0.01' placeholder='ìˆ˜ëŸ‰'/><label>ê°€ê²©</label><input id='f_price' type='number' step='1' placeholder='ê°€ê²©'/></div>`; document.getElementById('btnOrderSave').style.display='inline-block'; return; } if(!orderSelected || !orderSelected.id){ box.innerHTML = '<div class="muted" style="font-size:13px;">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”.</div>'; document.getElementById('btnOrderSave').style.display='none'; return; } const u=db.users[orderSelected.email]; const o=(u?.orders||[]).find(x=>x.id===orderSelected.id); if(!o){ box.innerHTML='<div class="muted">ì£¼ë¬¸ ì—†ìŒ</div>'; document.getElementById('btnOrderSave').style.display='none'; return; } if(orderEdit){ box.innerHTML = `<h3 style='margin:0 0 10px;'>ì£¼ë¬¸ ìˆ˜ì •</h3><div class='detail-grid'><div>íšŒì›</div><div>${u.email}</div><div>ì£¼ë¬¸ID</div><div>${o.id}</div><label>ìƒí’ˆ</label><input id='f_item' value='${o.item}'/><label>ìˆ˜ëŸ‰(g)</label><input id='f_qty' type='number' step='0.01' value='${o.qty}'/><label>ê°€ê²©</label><input id='f_price' type='number' step='1' value='${o.price}'/></div>`; document.getElementById('btnOrderSave').style.display='inline-block'; } else { box.innerHTML = `<div class='detail-grid'><div>íšŒì›</div><div>${u.email} <span class='pill' style='margin-left:6px;'>${u.username||''}</span></div><div>ì£¼ë¬¸ID</div><div>${o.id}</div><div>ìƒí’ˆ</div><div>${o.item}</div><div>ìˆ˜ëŸ‰(g)</div><div>${o.qty}</div><div>ê°€ê²©</div><div>${formatKR(o.price)}</div><div>ì‹œê°„</div><div>${new Date(o.ts).toLocaleString('ko-KR')}</div></div>`; document.getElementById('btnOrderSave').style.display='none'; } }
		document.getElementById('btnOrderCreate').addEventListener('click',()=>{ if(!orderSelected||!orderSelected.email){ alert('ì™¼ìª½ì—ì„œ íšŒì›ì˜ "+ ì¶”ê°€"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.'); return; } orderCreate=true; orderEdit=false; renderOrderDetail(); });
		document.getElementById('btnOrderEdit').addEventListener('click',()=>{ if(!orderSelected||!orderSelected.id) return; orderCreate=false; orderEdit=true; renderOrderDetail(); });
		document.getElementById('btnOrderSave').addEventListener('click', async ()=>{ const msg=document.getElementById('orderMsg'); if(orderCreate){ if(!confirm('ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const item=f_item.value.trim(); const qty=parseFloat(f_qty.value||''); const price=parseInt(f_price.value||''); if(!item||isNaN(qty)||isNaN(price)){ msg.textContent='í•„ìˆ˜ í•­ëª©'; return; } try{ await GSApp.addOrder(orderSelected.email,{item,qty,price}); msg.style.color='#4fc3f7'; msg.textContent='ì¶”ê°€ ì™„ë£Œ'; orderCreate=false; await GSApp.loadDB(); renderOrdersAll(); } catch(e){ msg.style.color='#ff5252'; msg.textContent='ì˜¤ë¥˜'; } } else if(orderEdit){ if(!confirm('ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const item=f_item.value.trim(); const qty=parseFloat(f_qty.value||''); const price=parseInt(f_price.value||''); if(!item||isNaN(qty)||isNaN(price)){ msg.textContent='í•„ìˆ˜ í•­ëª©'; return; } try{ await GSApp.updateOrder(orderSelected.email, orderSelected.id, {item,qty,price}); msg.style.color='#4fc3f7'; msg.textContent=GSApp.t('msg_update_success'); orderEdit=false; await GSApp.loadDB(); renderOrdersAll(); } catch(e){ msg.style.color='#ff5252'; msg.textContent=GSApp.t('msg_update_fail'); } } });
		document.getElementById('btnOrderDelete').addEventListener('click', async ()=>{ if(!orderSelected||!orderSelected.id) return; if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const db=GSApp.getDB(); const u=db.users[orderSelected.email]; u.orders=(u.orders||[]).filter(o=>o.id!==orderSelected.id); await GSApp.saveDB(); orderSelected=null; await GSApp.loadDB(); renderOrdersAll(); });
		document.getElementById('btnOrdersRefresh').addEventListener('click', async ()=>{ await GSApp.loadDB(); renderOrdersAll(); });
		function renderOrdersAll(){ renderAdminInfoOrders(); renderOrdersList(); renderOrderDetail(); }
		function initOrders(){ renderOrdersAll(); }

		// ===== Inquiries Inline Logic =====
		function renderAdminInfoInq(){ const box=document.getElementById('adminInfoInq'); const a=GSApp.currentUser(); if(!a){ box.innerHTML=''; return;} const online=a.lastSeenAt&&(Date.now()-a.lastSeenAt<5*60*1000); box.innerHTML=`<h3 style='margin:0 0 8px;' data-i18n='section_admin_info'>ê´€ë¦¬ì ì •ë³´</h3><div class='detail-grid'><div>ì•„ì´ë””</div><div>${a.username||''}</div><div>ì´ë©”ì¼</div><div>${a.email}</div><div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class=\"pill\" style=\"background:#2e7d32;color:#fff;\">ì˜¨ë¼ì¸</span>':'<span class=\"pill\">ì˜¤í”„ë¼ì¸</span>'}</div><div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${a.lastLoginAt? new Date(a.lastLoginAt).toLocaleString('ko-KR'):'-'}</div><div>ìµœê·¼ í™œë™</div><div>${a.lastSeenAt? new Date(a.lastSeenAt).toLocaleString('ko-KR'):'-'}</div><div>ì ‘ì† IP</div><div>${a.lastLoginIP||'-'}</div><div>ë¸Œë¼ìš°ì €</div><div class='nowrap'>${a.lastLoginUA||'-'}</div></div>`; }
		function collectInq(){ const db=GSApp.getDB(); const entries=[]; Object.values(db.users).forEach(u=>{ const msgs=(u.messages||[]).filter(m=>!m.fromAdmin); if(msgs.length) entries.push({email:u.email,username:u.username||'',messages:u.messages}); }); return entries; }
		function unreadCount(){ let c=0; const db=GSApp.getDB(); Object.values(db.users).forEach(u=>{ (u.messages||[]).forEach(m=>{ if(!m.fromAdmin && !m.read) c++; }); }); return c; }
		function renderInqList(){
			const only=document.getElementById('onlyUnread').checked;
			const data=collectInq();
			const box=document.getElementById('userList');
			const ucnt=unreadCount();
			const badge=document.getElementById('newCount');
			badge.style.display=ucnt>0? 'inline-block':'none';
			badge.textContent=ucnt;
			const html = data.map(d=>{
				const uUnread=(d.messages||[]).some(m=>!m.fromAdmin && !m.read);
				if(only && !uUnread) return '';
				const last=(d.messages||[]).filter(Boolean).slice(-1)[0];
				return `<div class='item ${uUnread?'unread':''}' data-email='${d.email}'>
					<div style='font-weight:600;'>${d.username||''} <span style='font-size:12px;color:#aaa;'>${d.email}</span> ${uUnread ? '<span class=\"pill\" style=\"background:#b71c1c;color:#fff;\">NEW</span>' : ''}</div>
					<div style='font-size:12px;color:#aaa;margin-top:4px;'>${last? last.content:''}</div>
				</div>`;
			}).join('');
			box.innerHTML = html || `<div class="muted" data-i18n="messages_empty_admin" style="padding:8px;">ìª½ì§€ ì—†ìŒ</div>`;
			box.querySelectorAll('.item').forEach(it=> it.addEventListener('click',()=>openThread(it.dataset.email)));
			if(window.GSApp) GSApp.applyLang();
		}
		function openThread(email){ const db=GSApp.getDB(); const u=db.users[email]; if(!u) return; document.getElementById('replyEmail').value=email; const t=document.getElementById('thread'); const msgs=(u.messages||[]).slice().sort((a,b)=>a.ts-b.ts); t.innerHTML = msgs.map(m=>`<div class='bubble ${m.fromAdmin?'from-admin':''}'>${m.fromAdmin?'<strong>[ê´€ë¦¬ì]</strong> ':''}${m.content}<div style='font-size:11px;color:#aaa;margin-top:4px;'>${new Date(m.ts).toLocaleString('ko-KR')}</div><div style='margin-top:6px;'><button class='btn small delMsg' data-id='${m.id}' data-email='${email}'>ì‚­ì œ</button></div></div>`).join(''); renderInqList(); }
		document.getElementById('onlyUnread').addEventListener('change',renderInqList);
		document.getElementById('btnInqRefresh').addEventListener('click', async ()=>{ await GSApp.loadDB(); renderInquiriesAll(); updateNewBadge(); });
		document.addEventListener('click', async (e)=>{ const btn=e.target.closest('.delMsg'); if(!btn) return; if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const db=GSApp.getDB(); const u=db.users[btn.dataset.email]; u.messages=(u.messages||[]).filter(m=>m.id!==btn.dataset.id); await GSApp.saveDB(); await GSApp.loadDB(); openThread(btn.dataset.email); updateNewBadge(); });
		document.getElementById('markReadBtn').addEventListener('click', async ()=>{ const email=document.getElementById('replyEmail').value; if(!email) return; const db=GSApp.getDB(); const u=db.users[email]; if(!u) return; let changed=false; (u.messages||[]).forEach(m=>{ if(!m.fromAdmin && !m.read){ m.read=true; changed=true; } }); if(changed){ await GSApp.saveDB(); await GSApp.loadDB(); } openThread(email); updateNewBadge(); });
		document.getElementById('sendReplyBtn').addEventListener('click', async ()=>{ const email=document.getElementById('replyEmail').value; const content=document.getElementById('replyContent').value.trim(); if(!email||!content) return; await GSApp.addMessage(email,content,true); const db=GSApp.getDB(); const u=db.users[email]; if(u){ let changed=false; (u.messages||[]).forEach(m=>{ if(!m.fromAdmin && !m.read){ m.read=true; changed=true; } }); if(changed) await GSApp.saveDB(); } document.getElementById('replyContent').value=''; openThread(email); updateNewBadge(); });
		function renderInquiriesAll(){ renderAdminInfoInq(); renderInqList(); }
		function initInquiries(){ renderInquiriesAll(); }
	</script>
</body></html>
