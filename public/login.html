<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="/api-rewrite.js"></script>
  <script src="/config.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ë¡œê·¸ì¸</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    body{padding-top:100px;}
    .login-wrap{max-width:420px;margin:0 auto;background:#102522;padding:40px 36px;border-radius:16px;color:#fff;box-shadow:0 0 20px rgba(0,0,0,.4);}
    .login-wrap h1{font-size:28px;margin-bottom:24px;color:#FFD700;text-align:center;}
    label{display:block;font-size:14px;margin:14px 0 6px;color:#ccc;}
    input{width:100%;padding:12px 14px;border:1px solid #1e4d47;background:#0b1917;color:#fff;border-radius:8px;font-size:15px;}
    input:focus{outline:2px solid #FFD700;}
    button{width:100%;padding:14px 18px;margin-top:26px;background:#00695C;border:none;color:#fff;font-size:17px;font-weight:600;border-radius:10px;cursor:pointer;transition:.3s;}
    button:hover{background:#00897B;}
    .msg{margin-top:12px;font-size:14px;min-height:18px;color:#ff5252;}
    .nav-right .user-link{font-size:14px;}
    .user-area{display:flex;justify-content:center;gap:10px;margin-top:20px;}
  </style>
</head>
<body>
<nav id="navbar">
  <div class="container">
    <div class="logo"><img src="img/logo.png" alt="logo" /></div>
      <div class="nav-center">
        <ul class="nav-links">
          <li><a href="index.html#section1">ì†Œê°œ</a></li>
          <li><a href="index.html#section2">ì§„í–‰</a></li>
          <li><a href="index.html#section3">ì˜ìƒ</a></li>
          <li><a href="index.html#section4">ì´ë ¥</a></li>
          <li><a href="index.html#section5">ë¬¸ì˜</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <a href="index.html" class="home-icon" aria-label="í™ˆ" style="display:flex;align-items:center;justify-content:center;width:56px;height:56px;background:#004d40;border-radius:16px;border:2px solid #00695C;transition:.3s;text-decoration:none;"><span style="font-size:30px;color:#FFD700;">ğŸ </span></a>
        <span id="navProfileBtn" style="display:none;margin-left:12px;"><a href="profile.html" style="color:#FFD700;font-weight:bold;font-size:16px;text-decoration:none;">ë‚´ì •ë³´</a></span>
  </div>
</nav>
<main>
  <div class="login-wrap">
    <h1>ë¡œê·¸ì¸</h1>
    <form id="loginForm">
      <label for="loginId">ì•„ì´ë””</label>
      <input type="text" id="loginId" required placeholder="ì•„ì´ë””" />
      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="password" required />
      <div class="msg" id="msg"></div>
      <button type="submit">ë¡œê·¸ì¸</button>
    </form>
    <div style="margin-top:14px;text-align:center;font-size:15px;color:#FFD700;">
      ì²˜ìŒì´ì‹œë©´ íšŒì›ê°€ì…ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.<br />
      <a href="signup.html"><button type="button" style="margin-top:10px;padding:10px 24px;background:#FFD700;color:#222;font-size:16px;font-weight:bold;border:none;border-radius:8px;cursor:pointer;">íšŒì›ê°€ì…</button></a>
    </div>
  </div>
</main>
<script src="app.js"></script>
<script>
  const idInput = document.getElementById('loginId');
  const pwInput = document.getElementById('password');
  const msg = document.getElementById('msg');

  idInput.addEventListener('input', function() {
    let val = idInput.value;
    const filtered = val.replace(/[^a-zA-Z0-9]/g, '');
    if (val !== filtered || /[A-Z]/.test(val)) {
      idInput.value = filtered.toLowerCase();
      msg.style.color = '#ff5252';
      msg.textContent = 'ì˜ë¬¸(ì†Œë¬¸ì), ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
    } else {
      msg.textContent = '';
    }
  });

  document.getElementById('loginForm').addEventListener('submit', async e => {
    e.preventDefault();
    const id = idInput.value.replace(/[^a-zA-Z0-9]/g, '').toLowerCase().trim();
    const pw = String(pwInput.value).trim();

    if (!id || !pw) {
      msg.style.color = '#ff5252';
      msg.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
      return;
    }

    try {
      const res = await window.GSApp.loginId(id, pw);

      // ì •ìƒ ì‘ë‹µ â†’ ì„¸ì…˜ ì €ì¥
      localStorage.setItem("user", JSON.stringify(res));

      if (res.role === 'ADMIN') {
        location.href = '/admin/index.html';
      } else {
        if (res.status === 'active') {
          location.href = 'profile.html';
        } else if (res.status === 'pending') {
          // ëŒ€ê¸° ìƒíƒœ: pending.htmlë¡œ ì´ë™ í›„, ë©”ì„¸ì§€ëŠ” í˜ì´ì§€ì—ì„œ ë…¸ì¶œ
          localStorage.clear();
          location.href = 'pending.html?msg=' + encodeURIComponent('íšŒì›ê°€ì… ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        } else if (res.status === 'rejected') {
          // ê±°ì ˆ ìƒíƒœ: ë©”ì„¸ì§€ alert í›„ index.htmlë¡œ ì´ë™
          alert('íšŒì›ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”!');
          localStorage.clear();
          location.href = 'index.html';
        }
      }
    } catch (err) {
      msg.style.color = '#ff5252';
      msg.textContent = err.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
    }
  });
</script>
</body>
</html>
