<!DOCTYPE html>
<html lang="ko">
<head>
  <script src="/api-rewrite.js"></script>
  <script src="/config.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>íšŒì›ê°€ì…</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body{padding-top:100px;}
    .signup-wrapper{max-width:480px;margin:0 auto;background:#102522;padding:40px 36px;border-radius:16px;color:#fff;box-shadow:0 0 20px rgba(0,0,0,.4);}
    .signup-wrapper h1{font-size:28px;margin-bottom:24px;color:#FFD700;text-align:center;}
    .signup-form label{display:block;font-size:14px;margin:14px 0 6px;color:#ccc;}
    .signup-form input{width:100%;padding:12px 14px;border:1px solid #1e4d47;background:#0b1917;color:#fff;border-radius:8px;font-size:15px;}
    .signup-form input:focus{outline:2px solid #FFD700;}
    .signup-form button{width:100%;padding:14px 18px;margin-top:26px;background:#00695C;border:none;color:#fff;font-size:17px;font-weight:600;border-radius:10px;cursor:pointer;transition:.3s;}
    .signup-form button:hover{background:#00897B;}
    .helper{text-align:center;margin-top:18px;font-size:14px;color:#aaa;}
    .helper a{color:#4fc3f7;text-decoration:none;}
    .msg{margin-top:12px;font-size:14px;color:#ff5252;min-height:18px;}
  /* ì•„ì´ë”” ì…ë ¥ì¹¸ ì „ì²´í­ + ì¤‘ë³µê²€ì‚¬ ë²„íŠ¼ ì˜¤ë²„ë ˆì´ */
  .username-row{position:relative;margin:0;padding:0;}
  .username-row input#username{width:100%;padding-right:118px;}
  .username-row .btn-dup{position:absolute;top:2px;right:2px;height:calc(100% - 4px);width:110px;min-width:110px;background:#004d43;font-size:13px;margin:0;padding:0 8px;border-radius:8px;}
  .username-row .btn-dup:hover{background:#00695C;}
  </style>
</head>
<body>
  <nav id="navbar">
    <div class="container">
  <div class="logo"><img src="img/logo.png" data-i18n-alt="alt_logo" alt="logo" /></div>
      <div class="nav-center">
        <ul class="nav-links">
          <li><a href="index.html#section1" data-i18n="nav_intro">ì†Œê°œ</a></li>
          <li><a href="index.html#section2" data-i18n="nav_progress">ì§„í–‰</a></li>
          <li><a href="index.html#section3" data-i18n="nav_video">ì˜ìƒ</a></li>
          <li><a href="index.html#section4" data-i18n="nav_history">ì´ë ¥</a></li>
          <li><a href="index.html#section5" data-i18n="nav_contact">ë¬¸ì˜</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <a href="index.html" class="home-icon" aria-label="í™ˆ" style="display:flex;align-items:center;justify-content:center;width:56px;height:56px;background:#004d40;border-radius:16px;border:2px solid #00695C;transition:.3s;text-decoration:none;"><span style="font-size:30px;color:#FFD700;">ğŸ </span></a>
        <div class="menu-btn" data-i18n-aria="aria_menu_open" aria-label="ë©”ë‰´" role="button" tabindex="0"><span></span><span></span><span></span></div>
      </div>
    </div>
  </nav>
  <main>
    <div class="signup-wrapper">
  <h1 data-i18n="page_signup_title">íšŒì›ê°€ì…</h1>
      <form class="signup-form" id="signupForm">
        <label for="username" data-i18n="label_username">ì•„ì´ë””</label>
  <div class="username-row">
          <input type="text" id="username" minlength="3" maxlength="20" pattern="[a-zA-Z0-9_]+" data-i18n-ph="placeholder_username" placeholder="ì˜ë¬¸/ìˆ«ì/ë°‘ì¤„ 3~20ì" required style="flex:1;" />
          <button type="button" id="dupCheckBtn" class="btn-dup" data-i18n="btn_check_duplicate">ì¤‘ë³µê²€ì‚¬</button>
        </div>
  <div id="dupMsg" style="font-size:12px;margin-top:4px;min-height:16px;color:#ccc;"></div>
  <label for="password" data-i18n="label_password">ë¹„ë°€ë²ˆí˜¸</label>
  <input type="password" id="password" minlength="6" placeholder="6ì ì´ìƒ" required />
  <label for="password2" data-i18n="label_password_confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
  <input type="password" id="password2" minlength="6" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" required />
  <label for="name" data-i18n="label_name">ì´ë¦„</label>
        <input type="text" id="name" required />
        <label for="birth" data-i18n="label_birth">ìƒë…„ì›”ì¼ (YYYY-MM-DD)</label>
        <input type="date" id="birth" required />
        <label for="phone" data-i18n="label_phone">ì—°ë½ì²˜</label>
        <input type="tel" id="phone" placeholder="010-1234-5678" pattern="[0-9\-]+" required />
  <label for="email" data-i18n="label_email">ì´ë©”ì¼</label>
  <input type="email" id="email" required />
        <label for="bank" data-i18n="label_bank">ì€í–‰</label>
        <select id="bank" required>
          <option value="">ì€í–‰ ì„ íƒ</option>
          <option>êµ­ë¯¼ì€í–‰</option><option>ì‹ í•œì€í–‰</option><option>ìš°ë¦¬ì€í–‰</option><option>í•˜ë‚˜ì€í–‰</option>
          <option>ê¸°ì—…ì€í–‰</option><option>ë†í˜‘ì€í–‰</option><option>ì¹´ì¹´ì˜¤ë±…í¬</option><option>í† ìŠ¤ë±…í¬</option>
          <option>SCì œì¼ì€í–‰</option><option>ì”¨í‹°ì€í–‰</option><option>ëŒ€êµ¬ì€í–‰</option><option>ë¶€ì‚°ì€í–‰</option>
          <option>ê²½ë‚¨ì€í–‰</option><option>ê´‘ì£¼ì€í–‰</option><option>ì „ë¶ì€í–‰</option><option>ì œì£¼ì€í–‰</option>
          <option>ìˆ˜í˜‘ì€í–‰</option><option>ì‚°ë¦¼ì¡°í•©</option><option>ìš°ì²´êµ­</option><option>ìƒˆë§ˆì„ê¸ˆê³ </option>
          <option>ì‹ í˜‘</option><option>ì¼€ì´ë±…í¬</option><option>ì €ì¶•ì€í–‰</option>
        </select>
  <label for="account" data-i18n="label_account">ê³„ì¢Œë²ˆí˜¸</label>
  <input type="text" id="account" data-i18n-ph="placeholder_account" placeholder="í•˜ì´í”ˆ ì—†ì´ ìˆ«ì" pattern="[0-9]+" required />
        <div class="msg" id="msg"></div>
  <button type="submit" data-i18n="btn_signup_submit">ê°€ì…ìš”ì²­í•˜ê¸°</button>
      </form>
  <!-- helper removed as per requirement -->
    </div>
  </main>
  <script src="app.js"></script>
  <script>
    // ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ ìƒíƒœ ê´€ë¦¬
    let usernameChecked = false;
    let lastUsernameValue = '';

    document.getElementById('dupCheckBtn').addEventListener('click', async ()=>{
      const username = document.getElementById('username').value.replace(/[^a-zA-Z0-9]/g, '').toLowerCase().trim();
      const dupMsg = document.getElementById('dupMsg');
      dupMsg.textContent = '';
      if (!username) {
        dupMsg.style.color = '#ff5252';
        dupMsg.textContent = 'ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        usernameChecked = false;
        return;
      }
      try {
        const res = await fetch('https://dupcheck.hanoiosaka1.workers.dev', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        const msg = await res.text();
        if (res.status === 200) {
          dupMsg.style.color = '#4fc3f7';
          usernameChecked = true;
          lastUsernameValue = username;
        } else {
          dupMsg.style.color = '#ff5252';
          usernameChecked = false;
        }
        dupMsg.textContent = msg;
      } catch (err) {
        dupMsg.style.color = '#ff5252';
        dupMsg.textContent = 'ì„œë²„ ì˜¤ë¥˜';
        usernameChecked = false;
      }
    });
    // í…Œë§ˆ ìŠ¤íƒ€ì¼ ì ìš©ì„ ìœ„í•œ select ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ
    const style = document.createElement('style');
    style.textContent = '.signup-form select{background:#0b1917;color:#fff;border:1px solid #1e4d47;padding:12px 14px;border-radius:8px;font-size:15px;} .signup-form select:focus{outline:2px solid #FFD700;}';
    document.head.appendChild(style);

    // ì „í™”ë²ˆí˜¸ í•˜ì´í”ˆ ìë™ ì‚½ì…
    const phoneInput = document.getElementById('phone');
    phoneInput.addEventListener('input', ()=>{
      if(v.startsWith('02')){
        if(v.length>2 && v.length<=5) v=v.replace(/(02)(\d{0,3})/, '$1-$2');
        else if(v.length>5 && v.length<=9) v=v.replace(/(02)(\d{3,4})(\d{0,4})/,'$1-$2-$3');
      } else {
        if(v.length>3 && v.length<=7) v=v.replace(/(\d{3})(\d{0,4})/,'$1-$2');
        else if(v.length>7) v=v.replace(/(\d{3})(\d{3,4})(\d{0,4})/,'$1-$2-$3');
      }
      phoneInput.value=v;
    });

    function validEmail(val){return /^[\w.!#$%&'*+/=?^`{|}~-]+@[A-Za-z0-9-]+(\.[A-Za-z0-9-]+)+$/.test(val);}

    const dupBtn=document.getElementById('dupCheckBtn');
    const dupMsg=document.getElementById('dupMsg');
    dupBtn.addEventListener('click', async ()=>{
  const val=document.getElementById('username').value.replace(/[^a-zA-Z0-9]/g, '').toLowerCase().trim();
      usernameChecked=false; lastUsernameValue='';
      if(!val){dupMsg.style.color='#ff5252';dupMsg.textContent=GSApp.t('dup_enter_username');return;}
      if(!/^[a-zA-Z0-9_]{3,20}$/.test(val)){dupMsg.style.color='#ff5252';dupMsg.textContent=GSApp.t('dup_invalid_format');return;}
      try {
  const res = await fetch('https://dupcheck.hanoiosaka1.workers.dev', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({username: val})
        });
        const msgText = await res.text();
        if(res.status === 200){
          dupMsg.style.color='#4fc3f7'; dupMsg.textContent=msgText; usernameChecked=true; lastUsernameValue=val;
        } else {
          dupMsg.style.color='#ff5252'; dupMsg.textContent=msgText;
        }
      } catch(err){
        dupMsg.style.color='#ff5252'; dupMsg.textContent='ì¤‘ë³µí™•ì¸ ì‹¤íŒ¨';
      }
    });
    document.getElementById('username').addEventListener('input',()=>{usernameChecked=false;dupMsg.style.color='#ccc';dupMsg.textContent='ì¤‘ë³µê²€ì‚¬ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.';});
    const usernameInput = document.getElementById('username');
    usernameInput.addEventListener('input', function(e) {
      let val = usernameInput.value;
      // ì˜ë¬¸ ëŒ€ë¬¸ì ì…ë ¥ì‹œ ìë™ ì†Œë¬¸ì ë³€í™˜
      if(/[A-Z]/.test(val)) {
        usernameInput.value = val.toLowerCase();
        dupMsg.style.color = '#ff5252';
        dupMsg.textContent = 'ì˜ë¬¸(ì†Œë¬¸ì), ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
      } else if(/[^a-z0-9]/.test(val)) {
        usernameInput.value = val.replace(/[^a-z0-9]/g, '');
        dupMsg.style.color = '#ff5252';
        dupMsg.textContent = 'ì˜ë¬¸(ì†Œë¬¸ì), ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
      } else {
        dupMsg.style.color = '#ccc';
        dupMsg.textContent = 'ì¤‘ë³µê²€ì‚¬ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.';
      }
      usernameChecked = false;
    });

    document.getElementById('signupForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const username = document.getElementById('username').value.replace(/[^a-zA-Z0-9]/g, '').toLowerCase().trim();
      const name = document.getElementById('name').value.trim();
      const birth = document.getElementById('birth').value;
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const bank = document.getElementById('bank').value;
      const account = document.getElementById('account').value.trim();
      const password = String(document.getElementById('password').value).trim();
      const password2 = String(document.getElementById('password2').value).trim();
      const msg = document.getElementById('msg');
      msg.style.color='#ff5252';
      if(!username || !name || !birth || !phone || !email || !bank || !account || !password || !password2){msg.textContent='ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.';return;}
      if(!usernameChecked || lastUsernameValue!==username){msg.textContent='ì•„ì´ë”” ì¤‘ë³µê²€ì‚¬ë¥¼ í•´ì£¼ì„¸ìš”.';return;}
      if(password!==password2){msg.textContent='ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';return;}
      if(!/^\S+@\S+\.\S+$/.test(email)){msg.textContent='ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';return;}
      try {
        const res = await fetch('https://signup.hanoiosaka1.workers.dev', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({username,name,birth,phone,email,bank,account,password})
        });
        const msgText = await res.text();
        if(res.status === 200){
          msg.style.color='#FFD700';
          msg.textContent='íšŒì›ê°€ì… ìŠ¹ì¸ìš”ì²­ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.\nìŠ¹ì¸ì´ ì™„ë£Œë˜ë©´ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
          setTimeout(()=>{ window.location.href='pending.html'; }, 1200);
        } else {
          msg.textContent = msgText || 'ê°€ì… ì‹¤íŒ¨';
        }
      } catch(err){
        msg.textContent = err.message || 'ê°€ì… ì‹¤íŒ¨';
      }
    });
    document.addEventListener('DOMContentLoaded',()=>{ if(window.GSApp) GSApp.applyLang(); });
  </script>
</body>
</html>
