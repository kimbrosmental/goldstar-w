<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>관리자 설정</title>
  <style>
    body{font-family:system-ui, AppleSDGothicNeo, sans-serif; padding:20px; max-width:800px; margin:0 auto;}
    h1{font-size:20px}
    fieldset{margin:12px 0; padding:12px; border:1px solid #ccc; border-radius:8px;}
    label{display:block; margin:6px 0 2px;}
    input,select{width:100%; padding:8px; border:1px solid #bbb; border-radius:6px;}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    button{padding:10px 14px; border:0; background:#111; color:#fff; border-radius:8px; cursor:pointer}
    .note{font-size:13px; color:#555}
    .ok{color:green} .err{color:#c00}
  </style>
</head>
<body>
  <h1>관리자 계정 설정 (최대 3명)</h1>
  <p class="note">※ 이 페이지는 일시적으로 열어서 초기 관리자 계정을 등록할 때만 사용하세요. 저장 시 서버가 암호화/해시하여 Cloudflare KV(SECURITY.adminid)에 보관합니다.</p>

  <div class="row">
    <label>Setup Token (X-Setup-Token)</label>
    <input id="token" placeholder="대시보드에 설정한 ADMIN_SETUP_TOKEN">
  </div>

  <form id="form">
    <fieldset>
      <legend>관리자 1</legend>
      <label>아이디</label><input id="u1">
      <label>비밀번호</label><input id="p1" type="password">
      <label>등급</label>
      <select id="r1"><option>ADMIN</option><option>MANAGER</option></select>
      <label>상태</label>
      <select id="s1"><option>active</option><option>inactive</option></select>
    </fieldset>
    <fieldset>
      <legend>관리자 2</legend>
      <label>아이디</label><input id="u2">
      <label>비밀번호</label><input id="p2" type="password">
      <label>등급</label>
      <select id="r2"><option>ADMIN</option><option>MANAGER</option></select>
      <label>상태</label>
      <select id="s2"><option>active</option><option>inactive</option></select>
    </fieldset>
    <fieldset>
      <legend>관리자 3</legend>
      <label>아이디</label><input id="u3">
      <label>비밀번호</label><input id="p3" type="password">
      <label>등급</label>
      <select id="r3"><option>ADMIN</option><option>MANAGER</option></select>
      <label>상태</label>
      <select id="s3"><option>active</option><option>inactive</option></select>
    </fieldset>
    <button type="submit">저장하기</button>
  </form>

  <p id="msg"></p>

  <script>
    const $ = (id)=>document.getElementById(id);
    document.getElementById('form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const admins = [];
      for (let i=1;i<=3;i++){
        const username = $(`u${i}`).value.trim();
        const password = $(`p${i}`).value;
        const role = $(`r${i}`).value;
        const status = $(`s${i}`).value;
        if (username && password){
          admins.push({ username, password, role, status });
        }
      }
      if (!admins.length){
        $('msg').innerHTML = '<span class="err">최소 1명 이상 입력하세요.</span>';
        return;
      }
      const token = $('token').value.trim();
      try{
        const res = await fetch('/api/adminset', {
          method:'POST',
          headers:{ 'Content-Type':'application/json', 'X-Setup-Token': token },
          body: JSON.stringify({ admins })
        });
        const data = await res.json();
        if (!res.ok){ throw new Error(data.error||'error'); }
        $('msg').innerHTML = '<span class="ok">저장 완료: '+data.count+'명</span>';
      }catch(err){
        $('msg').innerHTML = '<span class="err">실패: '+err.message+'</span>';
      }
    });
  </script>
</body>
</html>
