<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><title>íšŒì› ê´€ë¦¬</title><link rel="stylesheet" href="style.css"/><style>body{padding-top:100px;} .admin-wrap{max-width:100%;margin:0 auto;color:#fff;padding:20px 30px 80px;} h1{font-size:28px;margin-bottom:20px;color:#FFD700;} table{width:100%;border-collapse:collapse;} th,td{border:1px solid #1e4d47;padding:10px 12px;font-size:13px;} th{background:#004d40;color:#FFD700;} .flex{display:flex;gap:16px;flex-wrap:wrap;} .btn{background:#00695C;color:#fff;border:none;padding:10px 16px;border-radius:8px;font-size:13px;cursor:pointer;} .btn:hover{background:#00897B;} .btn.active{background:#00897B;box-shadow:0 0 0 2px rgba(255,215,0,.3) inset;} .danger{background:#b71c1c;} .danger:hover{background:#d32f2f;} .small{font-size:12px;} .pill{display:inline-block;padding:2px 6px;border-radius:12px;background:#1e4d47;font-size:11px;margin-left:4px;} .row-user.selected{background:rgba(255,255,255,.06);} .row-user.selected td{color:#ff5252;font-weight:600;} .detail-grid{display:grid;grid-template-columns:120px 1fr;gap:8px;} .detail-grid input{background:#0b1917;color:#fff;border:1px solid #1e4d47;border-radius:6px;padding:8px 10px;font-size:13px;} .detail-box{background:#0c1a18;border:1px solid #1e4d47;border-radius:10px;padding:14px;} .tabs{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 12px;} .right-tools{display:flex;gap:8px;align-items:center;margin-left:auto;} .headbar{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin:6px 0 14px;}</style></head><body>
<nav id="navbar"><div class="container"><div class="logo"><img src="img/logo.png" data-i18n-alt="alt_logo" alt="logo"/></div><div class="nav-center"><ul class="nav-links"><li><a href="index.html#section1" data-i18n="nav_intro">ì†Œê°œ</a></li><li><a href="index.html#section2" data-i18n="nav_progress">ì§„í–‰</a></li><li><a href="index.html#section3" data-i18n="nav_video">ì˜ìƒ</a></li><li><a href="index.html#section4" data-i18n="nav_history">ì´ë ¥</a></li><li><a href="index.html#section5" data-i18n="nav_contact">ë¬¸ì˜</a></li></ul></div><div class="nav-right"><div id="userArea" class="user-area"></div><a href="index.html" class="home-icon" data-i18n-aria="nav_home" aria-label="í™ˆ" style="display:flex;align-items:center;justify-content:center;width:56px;height:56px;background:#004d40;border-radius:16px;border:2px solid #00695C;transition:.3s;text-decoration:none;"><span style="font-size:30px;color:#FFD700;">ğŸ </span></a><div class="menu-btn" data-i18n-aria="aria_menu_open" aria-label="ë©”ë‰´" role="button" tabindex="0"><span></span><span></span><span></span></div></div></div></nav>
<main>
  <div class="admin-wrap">
    <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
    <div class="headbar">
      <div class="tabs" role="tablist" aria-label="Admin Tabs">
        <button class="btn active" id="tabUsers" type="button" role="tab" aria-selected="true" style="min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:8px;">
          <span>ğŸ‘¤</span><span data-i18n="tab_users_admin">íšŒì› ê´€ë¦¬</span>
        </button>
        <button class="btn" id="tabOrders" type="button" role="tab" aria-selected="false" style="min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:8px;">
          <span>ğŸ§¾</span><span data-i18n="section_orders_admin">ì£¼ë¬¸ ê´€ë¦¬</span>
        </button>
        <button class="btn" id="tabInquiries" type="button" role="tab" aria-selected="false" style="min-width:160px;display:inline-flex;align-items:center;justify-content:center;gap:8px;position:relative;">
          <span>ğŸ’¬</span><span data-i18n="section_messages_admin">1:1 ë¬¸ì˜</span>
          <span id="newBadge" class="pill" style="display:none;position:absolute;top:-8px;right:-8px;background:#b71c1c;color:#fff;">NEW</span>
        </button>
      </div>
      <div class="right-tools">
        <button class="btn" id="btnChangePw" data-i18n="btn_change_admin_password">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
  <button class="btn danger" id="btnLogout" type="button">ë¡œê·¸ì•„ì›ƒ</button>
        <span id="pwChangeMsg" class="hint"></span>
      </div>
    </div>
    <h2 style="margin:0 0 10px;">íšŒì› ê´€ë¦¬</h2>
    <!-- ê´€ë¦¬ì ì •ë³´ ìƒë‹¨ í‘œì‹œ -->
    <div id="adminInfo" class="detail-box" style="margin-bottom:14px;"></div>
    <div class="flex" style="align-items:flex-start;">
      <!-- ì¢Œì¸¡: ëª©ë¡ -->
      <div style="flex:1;min-width:420px;">
        <div style="display:flex;align-items:center;gap:8px;justify-content:space-between;">
          <h2 data-i18n="section_users" style="margin:0;">íšŒì› ëª©ë¡</h2>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="btnUsersRefresh" class="btn small" data-i18n="btn_refresh" style="padding:6px 10px;">ìƒˆë¡œê³ ì¹¨</button>
            <button id="btnExportCsv" class="btn small" style="padding:6px 10px;">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
          </div>
        </div>
        <div id="usersTable"></div>
      </div>
      <!-- ìš°ì¸¡: ìƒì„¸/ì•¡ì…˜ -->
      <div style="flex:1;min-width:420px;">
        <h2>ìƒì„¸/ê´€ë¦¬</h2>
        <div id="detail" class="detail-box" style="min-height:280px;">
          <div style="color:#aaa;font-size:13px;">ì™¼ìª½ ëª©ë¡ì—ì„œ íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”.</div>
        </div>
  <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
          <button class="btn" id="btnAdd" data-i18n="btn_add_user">ì¶”ê°€</button>
          <button class="btn" id="btnEdit" data-i18n="btn_edit">ìˆ˜ì •</button>
          <button class="btn" id="btnSave" style="display:none;">ìˆ˜ì •í™•ì¸</button>
          <button class="btn danger" id="btnDelete" data-i18n="btn_delete">ì‚­ì œ</button>
        </div>
        <div class="msg" id="userMsg" style="font-size:12px;margin-top:6px;"></div>
        <!-- ì¶”ê°€ í¼ì€ ìƒì„¸ ë°•ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ í‘œì‹œí•©ë‹ˆë‹¤. -->
      </div>
    </div>
  </div>
</main>
<script src="app.js"></script><script>
// If embedded in iframe, hide own navbar and reduce padding
if(window.top!==window.self){ document.addEventListener('DOMContentLoaded',()=>{ const nav=document.getElementById('navbar'); if(nav) nav.style.display='none'; document.body.style.paddingTop='12px'; }); }
const menuBtn=document.querySelector('.menu-btn');menuBtn?.addEventListener('click',()=>{menuBtn.classList.toggle('active');document.querySelector('.nav-links')?.classList.toggle('active');});
function requireAdmin(){const u=GSApp.currentUser();if(!u||u.role!=='admin'){alert('ê´€ë¦¬ì ê¶Œí•œ í•„ìš”');location.href='login.html';return false;}return true;}
// Tabs navigation (multi-page)
document.getElementById('tabUsers').addEventListener('click',e=>{ e.preventDefault(); try{ sessionStorage.setItem('admin_auto_refresh','1'); location.reload(); }catch(_){} });
document.getElementById('tabOrders').addEventListener('click',e=>{ e.preventDefault(); try{ sessionStorage.setItem('admin_auto_refresh','1'); }catch(_){ } location.href='admin-orders.html'; });
document.getElementById('tabInquiries').addEventListener('click',e=>{ e.preventDefault(); try{ sessionStorage.setItem('admin_auto_refresh','1'); }catch(_){ } location.href='admin-inquiries.html'; });
// Header NEW badge
function updateNewBadge(){ try{ const db=GSApp.getDB(); let unread=0; Object.values(db.users).forEach(u=>{ (u.messages||[]).forEach(m=>{ if(!m.fromAdmin && !m.read) unread++; }); }); const b=document.getElementById('newBadge'); if(b){ b.style.display = unread>0 ? 'inline-block' : 'none'; b.textContent = unread>0? ('NEW '+unread):''; } }catch(_){}}
let selectedEmail=null; let editMode=false; let createMode=false;
function renderAdminInfo(){
  const box=document.getElementById('adminInfo'); if(!box) return;
  const admin=GSApp.currentUser(); if(!admin){ box.innerHTML=''; return; }
  const online = admin.lastSeenAt && (Date.now()-admin.lastSeenAt < 5*60*1000);
  box.innerHTML = `
    <h3 style='margin:0 0 8px;' data-i18n='section_admin_info'>ê´€ë¦¬ì ì •ë³´</h3>
    <div class='detail-grid'>
      <div>ì•„ì´ë””</div><div>${admin.username||''}</div>
      <div>ì´ë©”ì¼</div><div>${admin.email}</div>
      <div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class="pill" style="background:#2e7d32;color:#fff;">ì˜¨ë¼ì¸</span>':'<span class="pill">ì˜¤í”„ë¼ì¸</span>'}</div>
      <div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${admin.lastLoginAt? new Date(admin.lastLoginAt).toLocaleString('ko-KR'):'-'}</div>
      <div>ìµœê·¼ í™œë™</div><div>${admin.lastSeenAt? new Date(admin.lastSeenAt).toLocaleString('ko-KR'):'-'}</div>
      <div>ì ‘ì† IP</div><div>${admin.lastLoginIP||'-'}</div>
      <div>ë¸Œë¼ìš°ì €</div><div style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>${admin.lastLoginUA||'-'}</div>
    </div>
  `;
}
function renderUsers(){
  const db=GSApp.getDB();
  const rows=Object.values(db.users).map(u=>`<tr class='row-user ${selectedEmail===u.email?'selected':''}' data-email='${u.email}'>
    <td>${u.username||''}</td>
    <td>${u.email}${u.role==='admin'?'<span class=\"pill\">admin</span>':''}</td>
    <td>${u.name||''}</td>
    <td>${u.phone||''}</td>
    <td>${(u.orders||[]).length}</td>
  </tr>`).join('');
  document.getElementById('usersTable').innerHTML=`<table><thead><tr><th>ì•„ì´ë””</th><th>ì´ë©”ì¼</th><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì£¼ë¬¸ìˆ˜</th></tr></thead><tbody>${rows}</tbody></table>`;
  document.querySelectorAll('.row-user').forEach(tr=>tr.addEventListener('click',()=>{ selectedEmail=tr.dataset.email; createMode=false; editMode=false; renderDetail(); renderUsers(); updateDeleteVisibility(); }));
  if(window.GSApp) GSApp.applyLang();
}
function renderDetail(){
  const box=document.getElementById('detail');
  if(createMode){
    box.innerHTML = `
      <h3 style='margin:0 0 10px;'>ì‹ ê·œ íšŒì› ì¶”ê°€</h3>
      <div class='detail-grid'>
        <label>ì•„ì´ë””</label><input id='f_username' placeholder='ì•„ì´ë””'/>
        <label>ì´ë¦„</label><input id='f_name' placeholder='ì´ë¦„'/>
        <label>ì´ë©”ì¼</label><input id='f_email' placeholder='ì´ë©”ì¼'/>
        <label>ì—°ë½ì²˜</label><input id='f_phone' placeholder='ì—°ë½ì²˜'/>
        <label>ìƒë…„ì›”ì¼</label><input id='f_birth' type='date'/>
        <label>ì€í–‰</label><input id='f_bank' placeholder='ì€í–‰'/>
        <label>ê³„ì¢Œ</label><input id='f_account' placeholder='ê³„ì¢Œë²ˆí˜¸'/>
        <label>ë¹„ë°€ë²ˆí˜¸</label><input id='f_password' type='password' placeholder='ë¹„ë°€ë²ˆí˜¸'/>
      </div>
    `;
    document.getElementById('btnSave').style.display='inline-block';
    return;
  }
  if(!selectedEmail){ box.innerHTML='<div style="color:#aaa;font-size:13px;">ì™¼ìª½ ëª©ë¡ì—ì„œ íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”.</div>'; document.getElementById('btnSave').style.display='none'; return; }
  const u=GSApp.getDB().users[selectedEmail]; if(!u){ box.innerHTML='<div>íšŒì› ì—†ìŒ</div>'; document.getElementById('btnSave').style.display='none'; return; }
  const online = u.lastSeenAt && (Date.now()-u.lastSeenAt < 5*60*1000);
  if(editMode){
    box.innerHTML = `
      <h3 style='margin:0 0 10px;'>íšŒì› ìˆ˜ì •</h3>
      <div class='detail-grid'>
        <label>ì•„ì´ë””</label><input id='f_username' value='${u.username||''}' disabled/>
        <label>ì´ë¦„</label><input id='f_name' value='${u.name||''}'/>
        <label>ì´ë©”ì¼</label><input id='f_email' value='${u.email}' disabled/>
        <label>ì—°ë½ì²˜</label><input id='f_phone' value='${u.phone||''}'/>
        <label>ìƒë…„ì›”ì¼</label><input id='f_birth' type='date' value='${u.birth||''}'/>
        <label>ì€í–‰</label><input id='f_bank' value='${u.bank||''}'/>
        <label>ê³„ì¢Œ</label><input id='f_account' value='${u.account||''}'/>
        <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label><input id='f_newpw' type='password' placeholder='ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥'/>
      </div>
    `;
    document.getElementById('btnSave').style.display='inline-block';
  } else {
    box.innerHTML = `
      <div class='detail-grid'>
        <div>ì•„ì´ë””</div><div>${u.username||''}</div>
        <div>ì´ë¦„</div><div>${u.name||''}</div>
        <div>ì´ë©”ì¼</div><div>${u.email}</div>
        <div>ì—°ë½ì²˜</div><div>${u.phone||''}</div>
        <div>ìƒë…„ì›”ì¼</div><div>${u.birth||''}</div>
        <div>ì€í–‰</div><div>${u.bank||''}</div>
        <div>ê³„ì¢Œ</div><div>${u.account||''}</div>
        <div>ê°€ì…ì¼</div><div>${u.created? new Date(u.created).toLocaleString('ko-KR'):''}</div>
        <div>ê¶Œí•œ</div><div>${u.role}</div>
        <div>ì ‘ì†ìƒíƒœ</div><div>${online? '<span class=\"pill\" style=\"background:#2e7d32;color:#fff;\">ì˜¨ë¼ì¸</span>':'<span class=\"pill\">ì˜¤í”„ë¼ì¸</span>'}</div>
        <div>ë§ˆì§€ë§‰ ì ‘ì†</div><div>${u.lastLoginAt? new Date(u.lastLoginAt).toLocaleString('ko-KR'):'-'}</div>
        <div>ìµœê·¼ í™œë™</div><div>${u.lastSeenAt? new Date(u.lastSeenAt).toLocaleString('ko-KR'):'-'}</div>
        <div>ì ‘ì† IP</div><div>${u.lastLoginIP||'-'}</div>
        <div>ë¸Œë¼ìš°ì €</div><div style='white-space:nowrap;overflow:hidden;text-overflow:ellipsis;'>${u.lastLoginUA||'-'}</div>
      </div>
    `;
    document.getElementById('btnSave').style.display='none';
  }
}
async function addUser(){
  const username=newUsername.value.trim(),name=newName.value.trim(),email=newEmail.value.trim().toLowerCase(),phone=newPhone.value.trim(),birth=newBirth.value,bank=newBank.value.trim(),account=newAccount.value.trim(),pw=newPass.value||'temp1234';
  const msg=userMsg; if(!username||!name||!email||!phone||!birth){msg.textContent='í•„ìˆ˜ í•­ëª©';return;}
  try{await GSApp.signupUser({username,name,birth,phone,email,bank,account,password:pw});msg.style.color='#4fc3f7';msg.textContent='ì¶”ê°€ ì™„ë£Œ';await GSApp.loadDB();renderAll(); setTimeout(()=>{ try{ document.getElementById('btnUsersRefresh').click(); }catch(_){ } }, 80);}
  catch(e){msg.textContent=e.message||'ì˜¤ë¥˜';}
}
function renderAll(){if(!requireAdmin())return;renderAdminInfo();renderUsers();renderDetail();GSApp.buildUserNav(); if(window.GSApp) GSApp.applyLang();}
document.getElementById('btnAdd').addEventListener('click',()=>{ createMode=true; editMode=false; selectedEmail=null; renderDetail(); });
document.getElementById('btnEdit').addEventListener('click',()=>{ if(!selectedEmail) return; createMode=false; editMode=true; renderDetail(); });
document.getElementById('btnSave').addEventListener('click', async ()=>{
  if(createMode){
    if(!confirm('ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    const username=f_username.value.trim(), name=f_name.value.trim(), email=f_email.value.trim().toLowerCase(), phone=f_phone.value.trim(), birth=f_birth.value, bank=f_bank.value.trim(), account=f_account.value.trim(), password=f_password.value||'temp1234';
    if(!username||!name||!email||!phone||!birth){ userMsg.textContent='í•„ìˆ˜ í•­ëª©'; return; }
  try{ await GSApp.signupUser({username,name,birth,phone,email,bank,account,password}); userMsg.style.color='#4fc3f7'; userMsg.textContent='ì¶”ê°€ ì™„ë£Œ'; createMode=false; selectedEmail=email; await GSApp.loadDB(); renderAll(); setTimeout(()=>{ try{ document.getElementById('btnUsersRefresh').click(); }catch(_){ } }, 80); }
    catch(e){ userMsg.style.color='#ff5252'; userMsg.textContent=e.message||'ì˜¤ë¥˜'; }
  } else if(editMode){
    if(!confirm('ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    const name=f_name.value.trim(), phone=f_phone.value.trim(), birth=f_birth.value, bank=f_bank.value.trim(), account=f_account.value.trim();
    const newPw=(document.getElementById('f_newpw')?.value||'').trim();
  try{ await GSApp.updateUser(selectedEmail,{name,phone,bank,account,birth}); if(newPw){ await GSApp.changePassword(selectedEmail,newPw); } userMsg.style.color='#4fc3f7'; userMsg.textContent=GSApp.t('msg_update_success'); editMode=false; await GSApp.loadDB(); renderAll(); setTimeout(()=>{ try{ document.getElementById('btnUsersRefresh').click(); }catch(_){ } }, 80); }
    catch(e){ userMsg.style.color='#ff5252'; userMsg.textContent=GSApp.t('msg_update_fail'); }
  }
});
document.getElementById('btnDelete').addEventListener('click',async()=>{
  if(!selectedEmail) return; const db=GSApp.getDB(); const u=db.users[selectedEmail]; if(u && u.role==='admin'){ alert('ê´€ë¦¬ì ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; } if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; delete db.users[selectedEmail]; await GSApp.saveDB(); selectedEmail=null; createMode=false; editMode=false; await GSApp.loadDB(); renderAll(); setTimeout(()=>{ try{ document.getElementById('btnUsersRefresh').click(); }catch(_){ } }, 80);
});
document.getElementById('btnUsersRefresh').addEventListener('click', async ()=>{ await GSApp.loadDB(); renderAll(); });
document.getElementById('btnExportCsv').addEventListener('click',()=>{
  const db=GSApp.getDB(); const rows=[['ì•„ì´ë””','ì´ë©”ì¼','ì´ë¦„','ì—°ë½ì²˜','ìƒë…„ì›”ì¼','ì€í–‰','ê³„ì¢Œ','ê¶Œí•œ','ì£¼ë¬¸ìˆ˜']];
  Object.values(db.users).forEach(u=>{ rows.push([u.username||'',u.email,u.name||'',u.phone||'',u.birth||'',u.bank||'',u.account||'',u.role||'',(u.orders||[]).length]); });
  const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\r\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='users.csv'; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
});
if(requireAdmin()) renderAll();
// ìë™ ìƒˆë¡œê³ ì¹¨: 5ì´ˆë§ˆë‹¤ ë Œë” ë° storage ë³€ê²½ ì‹œ ë Œë”
setInterval(()=>{ try{ if(requireAdmin()) { const curSel=selectedEmail; renderUsers(); if(curSel) selectedEmail=curSel; renderDetail(); } }catch(e){} }, 5000);
window.addEventListener('storage', (e)=>{ if(e.key==='member_db_secure_v1'){ renderAll(); }});

// Change password / Logout
document.getElementById('btnChangePw').addEventListener('click',async()=>{ if(!requireAdmin())return; const newPw=prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥'); if(!newPw) return; const admin=GSApp.currentUser(); try{ await GSApp.changePassword(admin.email,newPw); pwChangeMsg.style.color='#4fc3f7'; pwChangeMsg.textContent=GSApp.t('pw_change_success'); } catch(e){ pwChangeMsg.style.color='#ff5252'; pwChangeMsg.textContent=GSApp.t('pw_change_fail'); }});
document.getElementById('btnLogout').addEventListener('click',(e)=>{ e.preventDefault(); GSApp.logout(); location.href='index.html'; });

// Prevent deleting admin; toggle delete button visibility
function updateDeleteVisibility(){ const btn=document.getElementById('btnDelete'); if(!btn) return; const db=GSApp.getDB(); const u=selectedEmail? db.users[selectedEmail]:null; if(u && u.role==='admin'){ btn.style.display='none'; } else { btn.style.display='inline-block'; } }

// ì‚¬ìš©ì ê°œë³„ PW ë³€ê²½ ë²„íŠ¼ ì œê±° (ìš”ì²­ì— ë”°ë¼ ê¸°ëŠ¥ì€ ìˆ˜ì • í™”ë©´ì—ì„œ ì²˜ë¦¬)

document.addEventListener('DOMContentLoaded', async ()=>{ if(!requireAdmin()) return; await GSApp.loadDB(); updateNewBadge(); GSApp.buildUserNav(); if(window.GSApp) GSApp.applyLang(); updateDeleteVisibility(); await GSApp.loadDB(); renderAll(); });
window.addEventListener('pageshow', async ()=>{ try{ if(requireAdmin()){ await GSApp.loadDB(); renderAll(); } }catch(_){} });
</script></body></html>
